<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>真實大老二 - 數位試煉場</title>
    <style>
        :root { --primary: #2c3e50; --gold: #d4af37; --success: #27ae60; --fail: #c0392b; }
        body { font-family: sans-serif; background: #f0f2f5; display: flex; flex-direction: column; align-items: center; padding: 20px; }
        .game-container { background: white; padding: 2rem; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); max-width: 600px; width: 100%; }
        h1 { color: var(--primary); text-align: center; border-bottom: 2px solid var(--gold); }
        .setup, .play-area { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 8px; }
        .card-input { display: flex; gap: 10px; margin-bottom: 10px; }
        select, input, button { padding: 10px; border-radius: 5px; border: 1px solid #ccc; }
        button { cursor: pointer; background: var(--primary); color: white; transition: 0.3s; }
        button:hover { opacity: 0.8; }
        #log { height: 150px; overflow-y: auto; background: #222; color: #0f0; padding: 10px; font-family: monospace; font-size: 0.9rem; border-radius: 5px; }
        .status-dot { width: 15px; height: 15px; border-radius: 50%; display: inline-block; margin-right: 5px; }
        .truth-hidden { background: var(--primary); color: white; padding: 10px; text-align: center; font-weight: bold; border: 2px dashed var(--gold); }
    </style>
</head>
<body>

<div class="game-container">
    <h1>真實大老二：系統介面</h1>
    
    <div class="truth-hidden" id="truth-display">「真實」已隱藏於範疇之後</div>

    <div class="setup">
        <label>輸入玩家人數 (n): </label>
        <input type="number" id="player-count" value="4" min="2" max="10">
        <button onclick="initGame()">重新開始新局</button>
    </div>

    <div class="play-area">
        <h3>出牌與立法</h3>
        <div class="card-input">
            <select id="suit">
                <option value="♠">♠ 黑桃</option>
                <option value="♥">♥ 紅心</option>
                <option value="♦">♦ 方塊</option>
                <option value="♣">♣ 梅花</option>
            </select>
            <input type="number" id="rank" placeholder="點數(1-13)" min="1" max="13">
        </div>
        <div class="card-input">
            <select id="logic">
                <option value="proximity">立法：數值鄰近 (越近越強)</option>
                <option value="exact">立法：花色一致 (點數大者勝)</option>
            </select>
            <button onclick="submitPlay()" style="background: var(--success);">提交立法判斷</button>
        </div>
        <p id="chance-text">剩餘嘗試機會：2</p>
    </div>

    <div id="log">系統日誌：等待開局...</div>
    
    <button onclick="revealTruth()" style="margin-top:20px; background: #7f8c8d;">終局：翻開真實</button>
</div>

<script>
    let truth = null;
    let attempts = 2;
    const suits = ['♠', '♥', '♦', '♣'];
    const logEl = document.getElementById('log');

    function addLog(msg, color = "#0f0") {
        logEl.innerHTML += `<div style="color:${color}">> ${msg}</div>`;
        logEl.scrollTop = logEl.scrollHeight;
    }

    function initGame() {
        const n = document.getElementById('player-count').value;
        const deckSize = 51;
        const perPlayer = Math.floor(deckSize / n);
        
        // 隨機產生「真實」
        truth = {
            suit: suits[Math.floor(Math.random() * 4)],
            rank: Math.floor(Math.random() * 13) + 1
        };
        
        attempts = 2;
        document.getElementById('chance-text').innerText = `剩餘嘗試機會：2`;
        document.getElementById('truth-display').innerText = "「真實」已重新定義";
        
        addLog(`遊戲初始化：${n}名玩家。`, "white");
        addLog(`每人分發 ${perPlayer} 張牌，餘 ${deckSize % n} 張棄置。`);
        addLog(`莊家已抽出一張牌作為「真實」。`);
    }

    function submitPlay() {
        if (!truth) return alert("請先開始新局！");
        
        const playRank = parseInt(document.getElementById('rank').value);
        const playSuit = document.getElementById('suit').value;
        const logic = document.getElementById('logic').value;
        
        if (isNaN(playRank) || playRank < 1 || playRank > 13) return alert("請輸入正確點數");

        let success = false;
        
        if (logic === 'proximity') {
            // 簡化邏輯：如果比上一張更靠近真實則通過 (這裡模擬單次判定)
            // 實作：與真實距離小於等於 3 視為初步通過
            if (Math.abs(playRank - truth.rank) <= 3) success = true;
        } else {
            // 花色必須一致
            if (playSuit === truth.suit) success = true;
        }

        if (success) {
            addLog(`莊家點頭：${playSuit}${playRank} 通過「${logic}」立法！`, "#2ecc71");
            attempts = 2; // 重設機會
        } else {
            attempts--;
            addLog(`莊家搖頭：${playSuit}${playRank} 不符合真實引力。`, "#e74c3c");
            if (attempts > 0) {
                addLog(`理性試煉：你還有 1 次機會重新調整立法。`, "#f1c40f");
            } else {
                addLog(`最終失敗：強制 PASS。`, "#c0392b");
                attempts = 2; 
            }
        }
        document.getElementById('chance-text').innerText = `剩餘嘗試機會：${attempts}`;
    }

    function revealTruth() {
        if (!truth) return;
        document.getElementById('truth-display').innerText = `真實是：${truth.suit} ${truth.rank}`;
        addLog(`真相大白：本局的引力中心是 ${truth.suit}${truth.rank}。`, var(--gold));
    }

    // 初始化
    initGame();
</script>

</body>
</html>
