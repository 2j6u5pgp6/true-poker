<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>çœŸå¯¦å¤§è€äºŒ - æ•¸ä½å¯¦ä½œç‰ˆ</title>
    <style>
        :root { --bg: #1a1a1a; --card-bg: #fff; --primary: #e67e22; }
        body { font-family: "PingFang TC", "Microsoft JhengHei", sans-serif; background: var(--bg); color: white; display: flex; flex-direction: column; align-items: center; min-height: 100vh; margin: 0; padding: 20px; }
        
        /* éŠæˆ²å€åŸŸä½ˆå±€ */
        .game-board { width: 100%; max-width: 900px; display: grid; grid-template-columns: 1fr 300px; gap: 20px; }
        
        /* çœŸå¯¦èˆ‡æ—¥èªŒ */
        .status-panel { background: #2c3e50; padding: 20px; border-radius: 12px; border: 2px solid var(--primary); }
        .truth-zone { background: #000; height: 120px; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; margin-bottom: 20px; border: 1px dashed var(--primary); color: var(--primary); }
        #log { height: 300px; overflow-y: auto; background: #000; padding: 10px; font-family: monospace; font-size: 0.85rem; color: #00ff00; border-radius: 4px; }

        /* æ‰‹ç‰Œå€ */
        .hand-area { background: #222; padding: 20px; border-radius: 12px; }
        .cards-container { display: flex; flex-wrap: wrap; gap: 10px; min-height: 150px; }
        .card { width: 60px; height: 90px; background: white; color: black; border-radius: 6px; display: flex; flex-direction: column; align-items: center; justify-content: center; font-weight: bold; font-size: 1.2rem; cursor: pointer; transition: 0.2s; position: relative; border: 2px solid transparent; }
        .card.selected { transform: translateY(-15px); border-color: var(--primary); box-shadow: 0 0 15px var(--primary); }
        .card.red { color: #e74c3c; }

        /* æ“ä½œå€ */
        .controls { margin-top: 20px; display: flex; gap: 10px; align-items: center; background: #333; padding: 15px; border-radius: 8px; }
        button { background: var(--primary); border: none; padding: 10px 20px; color: white; border-radius: 4px; cursor: pointer; font-weight: bold; }
        button:disabled { background: #555; }
        select { padding: 10px; border-radius: 4px; }
    </style>
</head>
<body>

    <h1>çœŸå¯¦å¤§è€äºŒï¼šæ•¸ä½è©¦ç…‰</h1>

    <div class="game-board">
        <div class="main-play">
            <div class="hand-area">
                <h3>ä½ çš„æ‰‹ç‰Œ (ç©å®¶ 1)</h3>
                <div id="my-hand" class="cards-container"></div>
            </div>

            <div class="controls">
                <span>é¸æ“‡ç«‹æ³•ï¼š</span>
                <select id="logic-select">
                    <option value="proximity">æ•¸å€¼é„°è¿‘ (é„°è¿‘è€…å¼·)</option>
                    <option value="suit">èŠ±è‰²ä¸€è‡´ (é»æ•¸å¤§è€…å‹)</option>
                </select>
                <button id="btn-play" onclick="playCard()">æäº¤ç«‹æ³•å‡ºç‰Œ</button>
                <button id="btn-pass" style="background:#555" onclick="passTurn()">PASS</button>
            </div>
            
            <div style="margin-top: 15px;">
                äººæ•¸: <input type="number" id="n-players" value="4" style="width: 40px;">
                <button onclick="initGame()">é‡æ–°é–‹å±€</button>
            </div>
        </div>

        <div class="status-panel">
            <div id="truth-box" class="truth-zone">ï¼Ÿ çœŸå¯¦ ï¼Ÿ</div>
            <div id="log">ç³»çµ±å•Ÿå‹•ä¸­...</div>
            <button onclick="revealTruth()" style="width:100%; margin-top:10px; background:#c0392b;">æ­é–‹çœŸç›¸</button>
        </div>
    </div>

<script>
    let truth = null;
    let hand = [];
    let selectedIdx = -1;
    let attempts = 2;
    const suits = ['â™ ', 'â™¥', 'â™¦', 'â™£'];
    const suitNames = {'â™ ': 'black', 'â™¥': 'red', 'â™¦': 'red', 'â™£': 'black'};

    function addLog(msg, color = "#0f0") {
        const log = document.getElementById('log');
        log.innerHTML += `<div style="color:${color}">> ${msg}</div>`;
        log.scrollTop = log.scrollHeight;
    }

    function initGame() {
        // 1. ç”Ÿæˆç‰Œçµ„ä¸¦å–å‡ºã€ŒçœŸå¯¦ã€
        let deck = [];
        for (let s of suits) {
            for (let r = 1; r <= 13; r++) deck.push({s, r});
        }
        
        // éš¨æ©ŸæŠ½èµ°ä¸€å¼µä½œç‚ºçœŸå¯¦
        const tIdx = Math.floor(Math.random() * deck.length);
        truth = deck.splice(tIdx, 1)[0];
        
        // 2. åˆ†ç‰Œ
        const n = parseInt(document.getElementById('n-players').value);
        const perPlayer = Math.floor(51 / n);
        // æ´—ç‰Œ
        deck.sort(() => Math.random() - 0.5);
        hand = deck.slice(0, perPlayer).sort((a, b) => a.r - b.r);
        
        attempts = 2;
        document.getElementById('truth-box').innerText = "ï¼Ÿ çœŸå¯¦ ï¼Ÿ";
        addLog(`æ–°å±€é–‹å§‹ï¼Œäººæ•¸ï¼š${n}ã€‚`, "white");
        addLog(`å·²æ‰£é™¤ä¸€å¼µéš±è—ç‰Œä½œç‚ºã€ŒçœŸå¯¦ã€ã€‚`);
        addLog(`ä½ åˆ†åˆ°äº† ${perPlayer} å¼µç‰Œã€‚`);
        renderHand();
    }

    function renderHand() {
        const container = document.getElementById('my-hand');
        container.innerHTML = '';
        hand.forEach((card, idx) => {
            const div = document.createElement('div');
            div.className = `card ${suitNames[card.s]} ${selectedIdx === idx ? 'selected' : ''}`;
            div.innerHTML = `<span>${card.s}</span><span>${getRankName(card.r)}</span>`;
            div.onclick = () => { selectedIdx = idx; renderHand(); };
            container.appendChild(div);
        });
    }

    function getRankName(r) {
        if(r === 1) return 'A';
        if(r === 11) return 'J';
        if(r === 12) return 'Q';
        if(r === 13) return 'K';
        return r;
    }

    function playCard() {
        if (selectedIdx === -1) { alert("è«‹å…ˆé¸ä¸€å¼µç‰Œï¼"); return; }
        
        const card = hand[selectedIdx];
        const logic = document.getElementById('logic-select').value;
        let success = false;

        addLog(`è©¦åœ–ç«‹æ³•ï¼š${card.s}${getRankName(card.r)} (${logic === 'proximity' ? 'æ•¸å€¼é„°è¿‘' : 'èŠ±è‰²ä¸€è‡´'})`, "#aaa");

        // åˆ¤å®šé‚è¼¯
        if (logic === 'proximity') {
            // è¶Šæ¥è¿‘çœŸå¯¦é»æ•¸è¶Šå¼·ï¼Œé€™è£¡åˆ¤å®šç‚ºè·é›¢ 2 ä»¥å…§é€šé
            if (Math.abs(card.r - truth.r) <= 2) success = true;
        } else {
            // èŠ±è‰²å¿…é ˆå®Œå…¨ä¸€è‡´
            if (card.s === truth.s) success = true;
        }

        if (success) {
            addLog(`âœ… èŠå®¶é»é ­ï¼ç«‹æ³•é€šéã€‚`, "#2ecc71");
            hand.splice(selectedIdx, 1);
            selectedIdx = -1;
            attempts = 2;
            renderHand();
            if (hand.length === 0) addLog("ğŸ† ä½ è´äº†ï¼ä½ å·²é€²å…¥çœŸå¯¦çš„æ‡·æŠ±ã€‚", "gold");
        } else {
            attempts--;
            if (attempts > 0) {
                addLog(`âŒ èŠå®¶æ–é ­ã€‚ä¸åˆçœŸå¯¦ã€‚ä½ é‚„æœ‰ 1 æ¬¡æ©Ÿæœƒèª¿æ•´ã€‚`, "#f1c40f");
            } else {
                addLog(`âŒ æœ€çµ‚å¤±æ•—ã€‚ä½ å¿…é ˆ PASSã€‚`, "#c0392b");
                selectedIdx = -1;
                attempts = 2;
                renderHand();
            }
        }
    }

    function passTurn() {
        addLog("ä½ é¸æ“‡ PASSã€‚ç­‰å¾…ä¸‹ä¸€è¼ªã€‚");
        attempts = 2;
        selectedIdx = -1;
        renderHand();
    }

    function revealTruth() {
        document.getElementById('truth-box').innerText = `${truth.s} ${getRankName(truth.r)}`;
        addLog(`çœŸç›¸å¤§ç™½ï¼šæœ¬å±€çœŸå¯¦ç‚º ${truth.s}${getRankName(truth.r)}ã€‚`, "#e67e22");
    }

    initGame();
</script>
</body>
</html>
